<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Chatbot & Lawyer Recommendations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2a0f4a, #000000);
            color: white;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            display: flex;
            gap: 20px;
        }

        .chat-container, .recommendation-container {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-box, .recommendation-box {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .message {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            animation: fadeIn 0.5s ease-in-out;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            justify-content: flex-end;
        }

        .bot-message {
            justify-content: flex-start;
        }

        .bubble {
            padding: 12px;
            border-radius: 20px;
            max-width: 70%;
            word-wrap: break-word;
            font-size: 16px;
            position: relative;
        }

        .user-message .bubble {
            background: linear-gradient(45deg, #8a2be2, #6a0dad);
            color: white;
            border-top-right-radius: 0;
        }

        .bot-message .bubble {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-top-left-radius: 0;
        }

        .timestamp {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            position: absolute;
            bottom: -18px;
        }

        .input-area, .recommendation-inputs {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-gradient {
            background: linear-gradient(45deg, #8a2be2, #6a0dad);
            color: white;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            padding: 12px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff4e50, #f93232);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="chat-container">
        <h4 class="text-center mb-3">üí¨ Legal Chatbot</h4>
        <div id="chat-box" class="chat-box"></div>
        <div class="input-area">
            <input type="text" id="question" class="form-control" placeholder="Type your question...">
            <button class="btn-gradient" onclick="askQuestion()">Send</button>
            <button class="btn-gradient" onclick="clearChat()">Clear</button>
        </div>
    </div>

    <div class="recommendation-container">
        <h4 class="text-center mb-3">üîç Lawyer Recommendations</h4>
        <div id="recommendation-box" class="recommendation-box"></div>
        <div class="input-area">
            <!-- <input type="text" id="location" class="form-control" placeholder="Enter location...">
            <input type="text" id="specialization" class="form-control" placeholder="Enter specialization..."> -->
            <input type="text" id="query" class="form-control" placeholder="Enter your query...">

            <button class="btn-gradient" onclick="getRecommendations()">Search</button>
        </div>
    </div>
    
</div>

<button class="logout-btn" onclick="logout()">Logout</button>

<script>
    $(document).ready(function () {
        loadChatHistory();
    
        $("#question").keypress(function (event) {
            if (event.which === 13) {
                event.preventDefault();
                askQuestion();
            }
        });
    });
    
    function askQuestion() {
        var question = $("#question").val().trim();
        $("#question").val("");
        if (!question) return;
    
        appendMessage("user", question);
        showTypingIndicator();
    
        $.post("/ask", { question: question }, function (data) {
            removeTypingIndicator();
            appendMessage("bot", data.response);
            saveToLocalStorage(question, data.response);
        });
    }
    
    function appendMessage(sender, message) {
        var chatBox = $("#chat-box");
        var messageClass = sender === "user" ? "user-message" : "bot-message";
        var timeStamp = new Date().toLocaleTimeString();
    
        chatBox.append(`
            <div class="message ${messageClass}">
                <div class="bubble">${message}</div>
                <div class="timestamp">${timeStamp}</div>
            </div>
        `);
        chatBox.scrollTop(chatBox[0].scrollHeight);
    }
    
    function showTypingIndicator() {
        var chatBox = $("#chat-box");
        chatBox.append(`<div class="message bot-message" id="typing"><div class="bubble">...</div></div>`);
    }
    
    function removeTypingIndicator() {
        $("#typing").remove();
    }
    
    function saveToLocalStorage(userMessage, botMessage) {
        let chatHistory = JSON.parse(localStorage.getItem("chat_history")) || [];
        chatHistory.push({ user: userMessage, bot: botMessage });
        localStorage.setItem("chat_history", JSON.stringify(chatHistory));
    }
    
    function loadChatHistory() {
        let chatHistory = JSON.parse(localStorage.getItem("chat_history")) || [];
        chatHistory.forEach(chat => {
            appendMessage("user", chat.user);
            appendMessage("bot", chat.bot);
        });
    }
    
    function clearChat() {
        localStorage.removeItem("chat_history");
        $("#chat-box").empty();
    }

function getRecommendations() {
    // var location = $("#location").val().trim();
    // var specialization = $("#specialization").val().trim();
    let query = $("#query").val().trim();


    if (!query) {
        alert("Please enter a Valid Query.");
        return;
    }

    $.post("/recommend", { query: query }, function (data) {
        $("#recommendation-box").empty();
        if(typeof data.lawyers === "object"){
            data.lawyers.forEach(lawyer => {
                $("#recommendation-box").append(`<div class="bubble"><strong>${lawyer.name}</strong> <br>üìç ${lawyer.location} <br>‚öñÔ∏è ${lawyer.specialization} <br>üìÖ ${lawyer.experience} years experience</div>`);
            });
        }
        else{
            $("#recommendation-box").append(`<div class="bubble"><strong>‚ö†Ô∏è No lawyers found!</strong> <br></div>`);
        }
        
    });
}
function logout() {
        // Remove the authentication cookie
        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        
        // Redirect to login page
        window.location.href = "/login";
    }

    function checkLogin() {
        // Retrieve cookies and check for authentication token
        var token = getCookie("token");
        if (!token) {
            window.location.href = "/login"; // Redirect if not logged in
        }
    }

    function getCookie(name) {
        var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? match[2] : null;
    }
</script>
</body>
</html>